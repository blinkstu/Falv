<!DOCTYPE html>
<html>

<head>
    <title>专业鉴定-{$site_info.site_name|default=''}</title>
    <meta name="keywords" content="{$site_info.site_seo_keywords|default=''}" />
    <meta name="description" content="{$site_info.site_seo_description|default=''}">
    <link rel="stylesheet" href="__TMPL__/public/assets/css/city-picker.css">
    <include file="public@head" />
    <link href="__TMPL__/public/assets/css/slippry/slippry.css" rel="stylesheet">
    <style>
        .caption-wraper {
            position: absolute;
            left: 50%;
            bottom: 2em;
        }

        .caption-wraper .caption {
            position: relative;
            left: -50%;
            background-color: rgba(0, 0, 0, 0.54);
            padding: 0.4em 1em;
            color: #fff;
            -webkit-border-radius: 1.2em;
            -moz-border-radius: 1.2em;
            -ms-border-radius: 1.2em;
            -o-border-radius: 1.2em;
            border-radius: 1.2em;
        }

        .tc-gridbox {
            margin: 0;
        }
        .city-picker-selector .selector-item {
        width: calc(50% - 10px);
        margin: 0;
        margin-left: 20px;
        float: left;
      }
      .city-picker-selector .selector-item:first-child {
        margin-left: 0px;
      }

              .bg {
        animation: slide 3s ease-in-out infinite alternate;
        background-image: linear-gradient(
          -60deg,
          #ffffff 50%,
          rgb(255, 245, 218) 50%
        );
        bottom: 0;
        left: -50%;
        opacity: 0.5;
        position: fixed;
        right: -50%;
        top: 0;
        z-index: -1;
      }

      .bg2 {
        animation-direction: alternate-reverse;
        animation-duration: 4s;
      }

      .bg3 {
        animation-duration: 5s;
      }
      @keyframes slide {
        0% {
          transform: translateX(-25%);
        }
        100% {
          transform: translateX(25%);
        }
      }

        @media (max-width: 767px) {
            .caption-wraper {
                left: 0;
                bottom: 0.4em;
            }

            .caption-wraper .caption {
                left: 0;
                padding: 0.2em 0.4em;
                font-size: 0.92em;
                -webkit-border-radius: 0;
                -moz-border-radius: 0;
                -ms-border-radius: 0;
                -o-border-radius: 0;
                border-radius: 0;
            }
        }
    </style>
    <hook name="before_head_end" />
</head>

<body>
    <include file="public@nav" />
    <div class="bg"></div>
    <div class="bg bg2"></div>
    <div class="bg bg3"></div>
    <div class="container mt-4">
        <div class="new-case-content">
            <div class="col-md-6 mx-auto py-4">
                <div class="card hidden-card box-shadow" id="step-1">
                    <div class="card-body">
                        <h4 class="card-title heiti-std">发起新的专业鉴定</h4>
                        <div class="row bs-wizard" style="border-bottom:0;">
                        
                            <div class="col-3 bs-wizard-step pro-1 complete">
                                <div class="text-center bs-wizard-stepnum">第1步</div>
                                <div class="progress">
                                    <div class="progress-bar progress-bar-striped"></div>
                                </div>
                                <a href="#" class="bs-wizard-dot"></a>
                                <div class="bs-wizard-info text-center">简单描述</div>
                            </div>
                        
                            <div class="col-3 bs-wizard-step pro-2 disabled">
                                <div class="text-center bs-wizard-stepnum">第2步</div>
                                <!-- complete -->
                                <div class="progress">
                                    <div class="progress-bar progress-bar-striped"></div>
                                </div>
                                <a href="#" class="bs-wizard-dot"></a>
                                <div class="bs-wizard-info text-center">选择地址</div>
                            </div>
                        
                            <div class="col-3 bs-wizard-step pro-3  disabled">
                                <div class="text-center bs-wizard-stepnum">第3步</div>
                                <!-- complete -->
                                <div class="progress">
                                    <div class="progress-bar"></div>
                                </div>
                                <a href="#" class="bs-wizard-dot"></a>
                                <div class="bs-wizard-info text-center">选择领域</div>
                            </div>
                        
                            <div class="col-3 bs-wizard-step pro-4  disabled">
                                <div class="text-center bs-wizard-stepnum">第4步</div>
                                <!-- active -->
                                <div class="progress">
                                    <div class="progress-bar"></div>
                                </div>
                                <a href="#" class="bs-wizard-dot"></a>
                                <div class="bs-wizard-info text-center">完成</div>
                            </div>
                        </div>
                        <div class="step-1 card-text active animated zoomIn faster">
                            <div class="form-group">
                                <select placeholder="领域（多选）" class="multi-select">
                                    <foreach name="field" item="item">
                                        <option value="{$item.id}">{$item.name}</option>
                                    </foreach>
                                </select>
                            </div>
                            <div class="buttons">
                                <button type="button" class="btn btn-success previous pull-left">上一步</button>
                                <button type="button" class="btn btn-success pull-right next">下一步</button>
                            </div>
                        </div>
                        <div class="step-2 card-text  animated zoomIn faster">
                            <div class="form-group">
                                <textarea class="form-control" placeholder="请在此详细描述您需要鉴定的项目" id="exampleFormControlTextarea1" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-3"><label class="label" for="exampleFormControlInput1">附件(非必须)</label></div>
                                    <div class="col-md-9">
                                        <input id="file-1" type="hidden" name="file_url">
                                        <input id="file-1-name" style="width: 70%;float:left;" class='form-control' disabled type="text" name="file_name"
                                            title="图片名称">
                                        <a href="javascript:uploadOne('附件上传','#file-1','file');" style="width: 20%;float:right;color:#999" class="btn btn-light">上传</a>
                                        <small id="emailHelp" class="form-text text-muted pull-right">通过附件来补充说明(支持word文档)</small>
                                    </div>
                            
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-3"><label class="label" for="exampleFormControlInput1">手机号码</label></div>
                                    <div class="col-md-9"><input type="mobile" disabled class="form-control" id="exampleFormControlInput1" value="{$user.mobile}"></div>
                                    <small id="emailHelp" class="form-text text-muted pull-right">您的手机号码经过加密保护,不会泄露</small>
                                </div>
                            </div>
                            <div class="buttons">
                                <button type="button" class="btn btn-success previous pull-left">上一步</button>
                                <button type="button" class="btn btn-success pull-right next">下一步</button>
                            </div>
                        </div>
                        <div class="step-3 card-text  animated zoomIn faster">
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-3"><label class="label" for="exampleFormControlInput1">城市</label></div>
                                    <div class="col-md-9">
                                        <div class="city-picker-selector" id="city-picker-selector"></div>
                                    </div>
                                    <small id="emailHelp" class="form-text text-muted pull-right">务必选择真实城市，以得到可用的鉴定报告</small>
                                </div>
                            </div>
                            <hr>
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-3"><label class="label" for="exampleFormControlInput1">收件地址</label></div>
                                    <div class="col-md-9">
                                        <foreach name="address" item="address" key="key">
                                            <div class="custom-control custom-checkbox mr-sm-2  address-text">
                                                <input type="radio" class="custom-control-input" name="address_text" id="address-{$key}" value="{$address.id}" <?php echo $key==0?'checked':''; ?>>
                                                <label class="custom-control-label" id="address" for="address-{$key}">
                                                    {$address.province} 
                                                    {$address.city} 
                                                    {$address.district} 
                                                    {$address.street} 
                                                    {$address.details}
                                                    <div class="delete-text">
                                                        <a href="javascript:;" data-id="{$address.id}" data-address="{$address.details}" class='delete-address'>删除</a>
                                                    </div>
                                                </label>
                                            </div>
                                        </foreach>
                                        <button type="button" class="btn btn-light add-address btn-sm pull-right">添加新地址</button>
                                        <small id="emailHelp" class="form-text text-muted pull-right">用于机构为您邮寄鉴定报告</small>
                                    </div>
                                </div>
                            </div>
                            <div class="buttons">
                                <button type="button" class="btn btn-success previous pull-left">上一步</button>
                                <button type="button" class="btn btn-primary next pull-right">确认提交</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    </div>
    <include file="public@footer" />
    <!-- /container -->
        <script src="__STATIC__/js/jquery-ui.min.js"></script>
    <include file="public@scripts" />
        <script src="__STATIC__/js/custom.js"></script>
    <script>
        var step1 = $('.step-1');
        var step2 = $('.step-2');
        var step3 = $('.step-3');
        var next1 = $('.next',step1)
        var next2 = $('.next',step2)
        var previous2 = $('.previous',step2)
        var previous3 = $('.previous', step3);

        function strlen(str){
            var len = 0;
            for (var i = 0; i < str.length; i++) {
                var c = str.charCodeAt(i);
                //单字节加1 
                if ((c >= 0x0001 && c <= 0x007e) || (0xff60 <= c && c <= 0xff9f)) {
                    len++;
                }
                else {
                    len += 2;
                }
            }
            return len;
        }

          var windowWidth = document.body.clientWidth;
            if (windowWidth < 600) {
                var miniwidth = "80%";
            } else {
                var miniwidth = "600px";
            }

        $('.add-address').on('click',function(){
            layer.open({
                type: 2
                , title: '添加新地址'
                , content: '/user/profile/addAddress.html?'
                , maxmin: false
                , area: [miniwidth, '500px']
            });
        });

        $('.delete-address').on('click',function(){
            var name = $(this).data('address');
            var id = $(this).data('id');
            layer.confirm('确定要删除地址 ' + name + ' 吗？', {icon:3,title:'提示'},function(){
                $.ajax({
                    type: "POST",
                    url: "/user/profile/deleteAddress",
                    data: {id:id},
                    dataType: "json",
                    success: function (response) {
                        if(response.code == 1 ){
                            layer.msg(response.msg);
                            layer.close(index);
                        }else{
                            layer.msg(response.msg);
                        }
                    }
                });
            })
        })
        

        next1.on('click',function(){
            step(2);
        });
        next2.on('click', function () {
            text = $('#exampleFormControlTextarea1').val();
            if (text == '') {
                layer.msg('请详细描述您要鉴定的项目')
                //return false;
            }
            if (strlen(text) <= 60) {
                layer.msg('描述内容需至少30字');
                //return false;
            }
            step(3);
        });
        previous2.on('click',function(){
            step(1);
        });
        previous3.on('click', function () {
            step(2)
        })

        function progressController(index){
            $('.bs-wizard-step').removeClass('active complete');
            var currentStep = $('.pro-'+index)
            var max = 4;
            currentStep.removeClass('disabled active complete');
            currentStep.addClass('active');
            for(x=1;x<index;x++){
                var previousStep = $('.pro-'+x);
                previousStep.removeClass('disabled complete');
                previousStep.addClass('complete');
            }

            for (x = 4; x > index; x--) {
                console.log('x'+x)
                var nextStep = $('.pro-'+x);
                nextStep.removeClass('active complete');
                nextStep.addClass('disabled');
                //previousStep.addClass('disabled');
            }
        }

        
        function success(id, address, index) {
            console.log(id);
            console.log(address);
            layer.close(index);
        }

        function step(index) {
            progressController(index);
            $('.card-text.active').removeClass('active');
            $('.step-' + index).addClass('active');

        }
        $(".multi-select").selectify();
            var selector3 = $("#city-picker-selector").cityPicker({
            dataJson: cityData,
            renderMode: true,
            search: true,
            autoSelected: true,
            keyboard: true,
            level: 2,
            onChoiceEnd: function () {
                console.log(this.values);
            }
        });

    </script>
    <script src="__TMPL__/public/assets/js/slippry.min.js"></script>
    <script type="text/javascript" src="__TMPL__/public/assets/js/citydata.js"></script>
    <script type="text/javascript" src="__TMPL__/public/assets/js/city-picker.js"></script>
    <hook name="before_body_end" />
</body>

</html>